<!--
@Author: Nitya Narayan Gautam
@Date: 20-DEC-2016
@Desc: User Information [User info element]
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/paper-progress/paper-progress.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="nng-form">
  <template>
    <style include="shared-styles">
        :host {
                font-size: 1rem;
                display: block;
                color: black;
                width: inherit;
                height: inherit;
        }
        paper-progress {
                width: 100%;
        }

        paper-card.nngForm{
            width: 99%;
            min-width: 60%;
            margin-bottom:10px;
        }
        paper-material.eleContainer{
            position: relative;
            margin: 10px;
            padding: 20px;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        .formTitle{
            padding-left: 20px;
        }
    </style>

        <!-- AJAX Component -->
        <iron-ajax
            id="ajax"
            method="GET"
            handle-as="json"
            on-response="_ajaxResponse"
            on-error="_ajaxError"
        ></iron-ajax>&nbsp;

        <!-- <center> -->
        <paper-material elevation="0">
                <paper-card class="nngForm" elevation="2">
                        <!-- To render the Form components -->
                        <template is="dom-repeat" items="{{formElementsObj}}" as="form">
                                <!-- Form Title -->
                                <template is="dom-if" if="[[_validateFormTitle(form.title)]]">
                                    <h3 class="formTitle"> [[form.title]] </h3>
                                    <paper-progress value="120"></paper-progress>
                                </template>

                                <!-- Form Components -->
                                <paper-material  class="eleContainer" elevation="0">
                                            <!-- To render the Form element -->
                                            <template is="dom-repeat" items="{{form.params}}" as="param">
                                                    <!-- For Input as text-->
                                                    <template is="dom-if" if="[[_validateTextType(param.type)]]">
                                                        <paper-input id="[[param.id]]" label="[[param.label]]" name="[[param.name]]" value="[[param.value]]" required></paper-input>
                                                    </template>

                                                    <!-- For Input as File-->
                                                    <template is="dom-if" if="[[_validateFileType(param.type)]]">
                                                        <paper-input id="[[param.id]]" type="file" name="[[param.name]]" value="[[param.value]]"></paper-input>
                                                    </template>
                                            </template>

                                            <!-- Render Form Controls -->
                                            <span style="float:right;">
                                                <br/>
                                                <paper-button raised autofocus on-tap="_collectParams"> [[form.submitButtonText]] </paper-button>
                                                <paper-button raised autofocus> CANCEL </paper-button>
                                            </span><br/>
                                </paper-material><br/>
                        </template>
                </paper-card>
            <paper-material>

        </center>
  </template>

  <script>
    (function() {
      'use strict';
      console.log("nng-form is loaded.");
      Polymer({
        is: 'nng-form',

        properties: {
                formTitle: {
                    type: String,
                    value: 'UPLOAD_A_FILE',
                    notify: true
                },
                formMethod: {
                    type: String,
                    value: 'GET'
                },
                targetURL: {
                    type: String,
                    value: '/api/v1/polling'
                },
                formElementsObj: {
                    type: Array,
                    value: function(){ return []; },
                    notify: true
                },
                formParamsObj: {
                    type: Object,
                    value: function(){ return {}; },
                    notify: true
                },
                description:{
                        type: String,
                        value: 'Description of the title header.',
                }
        },

        /*
        -------------------------------------------------------
        -[ Private Methods for Component ]-
        -------------------------------------------------------
        */

        _validateTextType: function(key){
                                        return (key === 'text')? true : false;
        },

        _validateFileType: function(key){
                                        return (key === 'file')? true : false;
        },

        _validateFormTitle: function(title){
                                        return (title !== '') ? true : false;
        },

        //Collect the params.
        _collectParams: function(){
                //making a form.
                var form = new FormData();
                var _self=this;
                //Getting elements value by name.
                this.formElementsObj[0].params.map(function(elementObj){
                    var elementValue = document.getElementById(elementObj.id).value;
                    //console.log(">>>>>>>>" + elementValue);
                    form.append(elementObj.name, elementValue);
                });

                //logging the collected params.
                //console.dir(form);
                this._submit(form);
        },

        //Validating the params.
        _validateParam: function(param){},

        //Submitting the form.
        _submit: function(obj){
                this.$.ajax.method = this.formMethod;
                this.$.ajax.url = this.targetURL;
                this.$.ajax.body= obj;
                this.$.ajax.generateRequest();
        },

        //Ajax Methods
        _ajaxResponse: function(obj){
            console.dir(obj);
        },
        _ajaxError: function(err){
            console.dir(err);
        },

        /*
        -------------------------------------------------------
        -[ Component Events ]-
        -------------------------------------------------------
        */
        attached: function(){
            console.log('Element Attached');
        },

        ready: function(){
            console.log("Composing the parameter for the form.");
            //QUESTION: either via params passing or via database
            //TODO: have to implement this

            //Sample for the from array object.
            this.formElementsObj = [
                {
                    "title":"NNG-FORM-ELEMENT",
                    "target":"/api/v1/polling",
                    "submitButtonText":"UPLOAD NOW",
                    "backReference":"_scriptBack",
                    "params":[
                        {"type":"text", "label":"Provide your Comment for this application", "id":"comment1", "name":"comment1", "value":""},
                        {"type":"text", "label":"Does it worth using according you ?", "id":"comment2", "name":"comment2", "value":""},
                        {"type":"text", "label":"Provide your  suggestion(s)", "id":"suggestion", "name":"suggestion", "value":""}
                    ]
                }
            ];
        }

      });
    })();
  </script>
</dom-module>
