<!--
@Author: Nitya Narayan Gautam
@Date: 31-Oct-2016
@Desc: Welcome Node [Welcome Screen]
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">

<dom-module id="nng-welcome">
  <template>
    <style include="shared-styles">
      :host {
          font-size: 1rem;
          display: block;
          color: black;
          width: inherit;
          height: inherit;
      }

      span,
      input {
        @apply(--paper-font-body2);
      }
    </style>
    <style is="custom-style">
        .flex-wrap{
            @apply(--layout-horizontal);
            @apply(--layout-wrap);
        }
        .flex-equal-justified {
                @apply(--layout-horizontal);
                @apply(--layout-justified);
        }
        .c-header { @apply(--paper-font-headline); }
        .c-desc { color: var(--paper-grey-600); }
        .c-location {
                float: right;
                font-size: 15px;
                vertical-align: middle;
        }
        .c-read { color: var(--google-blue-500); }
        paper-card{
            margin-right:10px;
            margin-bottom: 10px;
        }
        paper-material.welcomeBoard{
            padding:20px;
        }
        paper-material.heading{
            padding: 20px;
            margin-bottom: 20px;
            color: white;
            background-color: var(--google-cyan-500, darkcyan);
        }
    </style>

        <!-- AJAX Component -->
        <iron-ajax
            id="ajax"
            method="GET"
            handle-as="json"
            on-response="_ajaxResponse"
            on-error="_ajaxError"
            >
        </iron-ajax>

        <!-- Web Element to Rendor -->
        <paper-material class="welcomeBoard" elevation="0">
            <template is="dom-repeat" items="{{homescrObj}}" as="page">

                <!-- page greeting -->
                <paper-material class="heading" elevation="1"> TODAY [Today In History] </paper-material>

                <!-- Contents for homescreen -->
                <div class="container">
                        <template is="dom-repeat" items="{{page.today}}" as="tile" index-as="i">
                            <paper-card elevation="1">
                                              <div class="card-content">
                                                    <div class="c-header"> {{i}} </div>
                                                    <p class="c-desc">
                                                        {{tile}}
                                                    </p>
                                              </div>
                                              <!--div class="card-actions">
                                                    <paper-button class="c-read" on-tap="_openStory"> Read More </paper-button>
                                                    <iron-collapse id="story" style="width:100%;">
                                                        {{tile.story}}
                                                    </iron-collapse>
                                              </div-->
                            </paper-card>
                        </template>
                </div>

            </template>
        </paper-material>



  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'nng-welcome',

        properties: {
                greeting: {
                    type: String,
                    value: 'Homescreen',
                    notify: true
                },
                apiServer:{
                        type: String,
                        value: 'http://192.168.11.111:10000/api/v1/getHomeScreenContent',
                },
                homescrObj:{
                        type: Array,
                        value: function(){ return []; },
                        notify: true
                }
        },

        _openStory: function(obj){
            //Opening the story relativly vai the following path.
            //console.log(obj.path[1].childNodes[3]);
            obj.path[1].childNodes[3].toggle();
        },
        attached: function(){
            //Call the AJAX and get the result.
            this.$.ajax.url = this.apiServer;
            this.$.ajax.method = 'GET';
            this.$.ajax.generateRequest();
        },
        _ajaxError: function(err){
            console.log(err);
        },
        _ajaxResponse: function(resObj){
            //console.dir(resObj);
            console.info('Response arrived.');
            console.dir(resObj.detail.response);
            this.homescrObj = resObj.detail.response;
        },
        ready: function(){
            //Sample Data brfore real data.
            this.homescrObj = [{
                "greeting":"Loading contents...",
                "tiles":[{}]
            }];

        }

      });
    })();
  </script>
</dom-module>
